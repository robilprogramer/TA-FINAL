<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagram BAB III - Sistem Chatbot LLM + RAG</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            text-align: center;
            color: white;
            padding: 40px 20px;
            margin-bottom: 30px;
        }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        header p { font-size: 1.2rem; opacity: 0.9; }
        .diagram-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            overflow: hidden;
        }
        .section-header {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: white;
            padding: 20px 30px;
        }
        .section-header h2 { font-size: 1.5rem; }
        .section-header p { margin-top: 8px; opacity: 0.9; font-size: 0.95rem; }
        .diagram-content { padding: 30px; overflow-x: auto; background: #fafafa; }
        .mermaid { display: flex; justify-content: center; }
        .description-box {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px 20px;
            margin: 20px 30px;
            border-radius: 0 8px 8px 0;
        }
        .description-box h4 { color: #1565c0; margin-bottom: 8px; }
        .description-box ul { margin-left: 20px; color: #424242; }
        .description-box li { margin: 5px 0; }
        footer { text-align: center; color: white; padding: 30px; opacity: 0.9; }
        @media print {
            body { background: white; }
            .diagram-section { break-inside: avoid; page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Diagram BAB III</h1>
            <p>Sistem Chatbot Berbasis LLM dengan RAG - YPI Al-Azhar Jakarta</p>
        </header>

        <!-- Diagram 1: Tahapan Penelitian -->
        <section class="diagram-section">
            <div class="section-header">
                <h2>üìã 1. Flowchart Tahapan Penelitian</h2>
                <p>Model Prototyping - Research and Development (R&D)</p>
            </div>
            <div class="description-box">
                <h4>Deskripsi Tahapan:</h4>
                <ul>
                    <li><strong>Tahap 1:</strong> Analisis Kebutuhan - Wawancara, Observasi, Survei</li>
                    <li><strong>Tahap 2:</strong> Perancangan Sistem - Arsitektur, Database, API, UI</li>
                    <li><strong>Tahap 3:</strong> Implementasi Prototype - Development sistem</li>
                    <li><strong>Tahap 4:</strong> Pengujian Sistem - Testing dan evaluasi metrik</li>
                    <li><strong>Tahap 5:</strong> Evaluasi & Penyempurnaan - Iterasi perbaikan</li>
                </ul>
            </div>
            <div class="diagram-content">
                <pre class="mermaid">
flowchart TD
    subgraph TAHAP1["TAHAP 1: ANALISIS KEBUTUHAN"]
        A1([Mulai]) --> A2[Studi Literatur]
        A2 --> A3[Wawancara Stakeholder]
        A3 --> A4[Observasi Sistem Berjalan]
        A4 --> A5[Survei Pengguna]
        A5 --> A6{Validasi Kebutuhan}
        A6 -->|Tidak Valid| A3
        A6 -->|Valid| A7[Dokumen SRS]
    end

    subgraph TAHAP2["TAHAP 2: PERANCANGAN SISTEM"]
        B1[Perancangan Arsitektur] --> B2[Perancangan Data Pipeline]
        B2 --> B3[Perancangan RAG Engine]
        B3 --> B4[Perancangan Database]
        B4 --> B5[Perancangan API]
        B5 --> B6[Perancangan UI/UX]
        B6 --> B7{Review Desain}
        B7 -->|Revisi| B1
        B7 -->|Approved| B8[Dokumen Desain]
    end

    subgraph TAHAP3["TAHAP 3: IMPLEMENTASI PROTOTYPE"]
        C1[Setup Environment] --> C2[Implementasi Data Ingestion]
        C2 --> C3[Implementasi Processing Pipeline]
        C3 --> C4[Implementasi RAG Engine]
        C4 --> C5[Implementasi Backend API]
        C5 --> C6[Implementasi Frontend UI]
        C6 --> C7[Integrasi Sistem]
        C7 --> C8[Prototype Chatbot]
    end

    subgraph TAHAP4["TAHAP 4: PENGUJIAN SISTEM"]
        D1[Unit Testing] --> D2[Integration Testing]
        D2 --> D3[Functional Testing]
        D3 --> D4[Retrieval Quality Testing]
        D4 --> D5[Response Quality Testing]
        D5 --> D6[User Acceptance Testing]
        D6 --> D7{Hasil Pengujian}
        D7 -->|Gagal| D8[Identifikasi Bug]
        D8 --> C4
        D7 -->|Lulus| D9[Laporan Pengujian]
    end

    subgraph TAHAP5["TAHAP 5: EVALUASI & PENYEMPURNAAN"]
        E1[Analisis Hasil] --> E2[Identifikasi Perbaikan]
        E2 --> E3[Implementasi Perbaikan]
        E3 --> E4[Re-testing]
        E4 --> E5{Evaluasi Akhir}
        E5 -->|Belum Memenuhi| E2
        E5 -->|Memenuhi| E6[Dokumentasi Final]
        E6 --> E7[Sistem Final]
        E7 --> E8([Selesai])
    end

    A7 --> B1
    B8 --> C1
    C8 --> D1
    D9 --> E1

    style TAHAP1 fill:#e3f2fd,stroke:#1976d2
    style TAHAP2 fill:#e8f5e9,stroke:#388e3c
    style TAHAP3 fill:#fff3e0,stroke:#f57c00
    style TAHAP4 fill:#fce4ec,stroke:#c2185b
    style TAHAP5 fill:#f3e5f5,stroke:#7b1fa2
                </pre>
            </div>
        </section>

        <!-- Diagram 2: Arsitektur Sistem -->
        <section class="diagram-section">
            <div class="section-header" style="background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);">
                <h2>üèóÔ∏è 2. Diagram Arsitektur Sistem</h2>
                <p>Microservices Architecture - Layered Design</p>
            </div>
            <div class="description-box" style="background: #e8f5e9; border-color: #388e3c;">
                <h4 style="color: #2e7d32;">Komponen Arsitektur:</h4>
                <ul>
                    <li><strong>Presentation Layer:</strong> Chat Interface, Admin Dashboard</li>
                    <li><strong>Application Layer:</strong> FastAPI Backend, Business Logic</li>
                    <li><strong>RAG Engine Layer:</strong> Query Processing, Retrieval, Generation</li>
                    <li><strong>Database Layer:</strong> ChromaDB (Vector), PostgreSQL (Relational)</li>
                    <li><strong>Processing Layer:</strong> Text Chunking, Embedding Generation</li>
                    <li><strong>Data Ingestion Layer:</strong> PDF Parser, Metadata Extraction</li>
                </ul>
            </div>
            <div class="diagram-content">
                <pre class="mermaid">
flowchart TB
    subgraph PRESENTATION["PRESENTATION LAYER"]
        UI1[Chat Interface]
        UI2[Admin Dashboard]
        UI3[Document Management]
        UI4[Status Tracking]
    end

    subgraph APPLICATION["APPLICATION LAYER"]
        API[FastAPI Backend]
        IM[Intent Manager]
        SM[Session Manager]
        BL[Business Logic]
    end

    subgraph RAG["RAG ENGINE LAYER"]
        QR[Query Rewriter]
        SR[Semantic Retriever]
        CR[Context Ranker]
        PE[Prompt Engineer]
        RG[Response Generator]
    end

    subgraph DATABASE["DATABASE LAYER"]
        VDB[(ChromaDB\nVector Store)]
        RDB[(PostgreSQL\nRelational DB)]
    end

    subgraph PROCESSING["PROCESSING PIPELINE LAYER"]
        AR[AI Rewriter]
        TC[Text Chunker]
        CE[Chunk Enhancer]
        ME[Metadata Enricher]
        EG[Embedding Generator]
    end

    subgraph INGESTION["DATA INGESTION LAYER"]
        UP[Upload Handler]
        PP[PDF Parser]
        TE[Text Extractor]
        MS[Metadata Storage]
    end

    subgraph EXTERNAL["EXTERNAL SERVICES"]
        LLM[LLM API\nGPT-4 / Claude]
        EMB[Embedding API\ntext-embedding-3-small]
    end

    UI1 --> API
    UI2 --> API
    UI3 --> API
    UI4 --> API

    API --> IM
    API --> SM
    API --> BL
    IM --> QR

    QR --> SR
    SR --> VDB
    SR --> CR
    CR --> PE
    PE --> RG
    RG --> LLM
    RG --> API

    AR --> TC
    TC --> CE
    CE --> ME
    ME --> EG
    EG --> EMB
    EG --> VDB

    UP --> PP
    PP --> TE
    TE --> MS
    MS --> RDB
    TE --> AR

    BL --> RDB
    SM --> RDB

    style PRESENTATION fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    style APPLICATION fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    style RAG fill:#ffe0b2,stroke:#f57c00,stroke-width:2px
    style DATABASE fill:#f8bbd0,stroke:#c2185b,stroke-width:2px
    style PROCESSING fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px
    style INGESTION fill:#b2ebf2,stroke:#0097a7,stroke-width:2px
    style EXTERNAL fill:#ffecb3,stroke:#ffa000,stroke-width:2px
                </pre>
            </div>
        </section>

        <!-- Diagram 3: RAG Engine Flow -->
        <section class="diagram-section">
            <div class="section-header" style="background: linear-gradient(135deg, #f57c00 0%, #ef6c00 100%);">
                <h2>üîÑ 3. Flowchart RAG Engine</h2>
                <p>Proses Query hingga Response Generation</p>
            </div>
            <div class="description-box" style="background: #fff3e0; border-color: #f57c00;">
                <h4 style="color: #ef6c00;">Alur Proses RAG:</h4>
                <ul>
                    <li><strong>Query Processing:</strong> Analisis, Entity Extraction, Query Rewriting</li>
                    <li><strong>Semantic Retrieval:</strong> Vector Search dengan Cosine Similarity</li>
                    <li><strong>Context Assembly:</strong> Top-K Documents, Ranking, Truncation</li>
                    <li><strong>Response Generation:</strong> Prompt Engineering + LLM Inference</li>
                </ul>
            </div>
            <div class="diagram-content">
                <pre class="mermaid">
flowchart TD
    subgraph INPUT["INPUT"]
        A([User Query])
    end

    subgraph QUERY_PROCESSING["QUERY PROCESSING"]
        B[Query Analysis]
        C[Entity Extraction]
        D[Context Enrichment]
        E[Query Rewriting]
    end

    subgraph RETRIEVAL["SEMANTIC RETRIEVAL"]
        F[Query Embedding]
        G[Vector Search\nCosine Similarity]
        H[Metadata Filtering]
        I[Hybrid Search\nSemantic + Keyword]
    end

    subgraph CONTEXT["CONTEXT ASSEMBLY"]
        J[Top-K Documents]
        K[Deduplication]
        L[Relevance Ranking]
        M[Context Truncation]
    end

    subgraph GENERATION["RESPONSE GENERATION"]
        N[System Prompt]
        O[Retrieved Context]
        P[Conversation History]
        Q[User Query]
        R[Prompt Assembly]
        S[LLM Inference]
    end

    subgraph OUTPUT["OUTPUT"]
        T[Response + Citations]
        U([User Response])
    end

    A --> B
    B --> C
    C --> D
    D --> E

    E --> F
    F --> G
    G --> H
    H --> I

    I --> J
    J --> K
    K --> L
    L --> M

    M --> O
    N --> R
    O --> R
    P --> R
    Q --> R
    R --> S
    S --> T
    T --> U

    style INPUT fill:#e3f2fd,stroke:#1976d2
    style QUERY_PROCESSING fill:#e8f5e9,stroke:#388e3c
    style RETRIEVAL fill:#fff3e0,stroke:#f57c00
    style CONTEXT fill:#fce4ec,stroke:#c2185b
    style GENERATION fill:#f3e5f5,stroke:#7b1fa2
    style OUTPUT fill:#e0f7fa,stroke:#00796b
                </pre>
            </div>
        </section>

        <!-- Diagram 4: Data Pipeline -->
        <section class="diagram-section">
            <div class="section-header" style="background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%);">
                <h2>üì• 4. Flowchart Data Pipeline</h2>
                <p>Proses Dokumen ke Knowledge Base</p>
            </div>
            <div class="description-box" style="background: #fce4ec; border-color: #c2185b;">
                <h4 style="color: #ad1457;">Tahapan Data Pipeline:</h4>
                <ul>
                    <li><strong>Data Ingestion:</strong> Upload PDF, Parsing, Text Extraction</li>
                    <li><strong>AI Quality Assurance:</strong> Content Rewriting, Quality Evaluation</li>
                    <li><strong>Text Chunking:</strong> 1000 char dengan overlap 200</li>
                    <li><strong>Metadata Enrichment:</strong> Sumber, Kategori, Lokasi, Jenjang</li>
                    <li><strong>Embedding Generation:</strong> Representasi vektor semantik</li>
                </ul>
            </div>
            <div class="diagram-content">
                <pre class="mermaid">
flowchart TD
    subgraph INGESTION["DATA INGESTION"]
        A([Mulai]) --> B[Upload Dokumen PDF]
        B --> C[PDF Parser / OCR]
        C --> D[Raw Text Extraction]
        D --> E[Metadata Storage]
    end

    subgraph QUALITY["AI QUALITY ASSURANCE"]
        F[AI Content Rewriting]
        G[Quality Evaluation]
        H{Data Layak?}
        I[Feedback & Rekomendasi]
    end

    subgraph CHUNKING["TEXT CHUNKING"]
        J[Update Raw Text]
        K[Text Chunking\n1000 char, overlap 200]
        L[Chunk Quality Enhancement]
        M{Chunk Optimal?}
        N[Update Chunk Content]
    end

    subgraph ENRICHMENT["METADATA & EMBEDDING"]
        O[Metadata Enrichment]
        P[Sumber Dokumen]
        Q[Kategori Informasi]
        R[Lokasi/Cabang]
        S[Jenjang Pendidikan]
        T[Periode Berlaku]
        U[Embedding Generation]
    end

    subgraph STORAGE["DATABASE STORAGE"]
        V[(Vector Database\nChromaDB)]
        W[(Relational Database\nPostgreSQL)]
        X([Selesai])
    end

    E --> F
    F --> G
    G --> H
    H -->|Tidak| I
    I --> F
    H -->|Ya| J

    J --> K
    K --> L
    L --> M
    M -->|Tidak| K
    M -->|Ya| N

    N --> O
    O --> P
    O --> Q
    O --> R
    O --> S
    O --> T
    P & Q & R & S & T --> U

    U --> V
    U --> W
    V --> X
    W --> X

    style INGESTION fill:#e3f2fd,stroke:#1976d2
    style QUALITY fill:#e8f5e9,stroke:#388e3c
    style CHUNKING fill:#fff3e0,stroke:#f57c00
    style ENRICHMENT fill:#fce4ec,stroke:#c2185b
    style STORAGE fill:#f3e5f5,stroke:#7b1fa2
                </pre>
            </div>
        </section>

        <!-- Diagram 5: Conversation Flow -->
        <section class="diagram-section">
            <div class="section-header" style="background: linear-gradient(135deg, #7b1fa2 0%, #6a1b9a 100%);">
                <h2>üí¨ 5. Flowchart Conversation Mode</h2>
                <p>Mode Informational vs Transactional</p>
            </div>
            <div class="description-box" style="background: #f3e5f5; border-color: #7b1fa2;">
                <h4 style="color: #6a1b9a;">Mode Percakapan:</h4>
                <ul>
                    <li><strong>Mode Informational:</strong> Menjawab pertanyaan berbasis knowledge base</li>
                    <li><strong>Mode Transactional:</strong> Memandu proses pendaftaran siswa baru</li>
                    <li><strong>Step Transactional:</strong> Welcome ‚Üí Data Siswa ‚Üí Data Orang Tua ‚Üí Data Akademik ‚Üí Upload Dokumen ‚Üí Konfirmasi ‚Üí Submit</li>
                </ul>
            </div>
            <div class="diagram-content">
                <pre class="mermaid">
flowchart TD
    A([User Message]) --> B[Intent Classification]
    
    B --> C{Mode?}
    
    C -->|Informational| D[Query Processing]
    C -->|Transactional| E[Transaction Handler]
    
    subgraph INFO["MODE INFORMATIONAL"]
        D --> F[Entity Recognition]
        F --> G[Query Rewriting]
        G --> H[Semantic Retrieval]
        H --> I[Context Assembly]
        I --> J[LLM Generation]
        J --> K[Response + Citation]
    end
    
    subgraph TRANS["MODE TRANSACTIONAL"]
        E --> L{Step?}
        
        L -->|Welcome| M[Greeting & Overview]
        L -->|Data Siswa| N[Collect Student Data]
        L -->|Data Orang Tua| O[Collect Parent Data]
        L -->|Data Akademik| P[Collect Academic Data]
        L -->|Upload Dokumen| Q[Document Upload]
        L -->|Konfirmasi| R[Data Confirmation]
        L -->|Submit| S[Generate Registration Number]
        
        M --> T{Valid?}
        N --> T
        O --> T
        P --> T
        Q --> T
        R --> T
        
        T -->|Invalid| U[Error Message + Retry]
        U --> L
        T -->|Valid| V[Save to Database]
        V --> W[Next Step]
        W --> L
        
        S --> X[Registration Complete]
    end
    
    K --> Y([Response to User])
    X --> Y
    
    Y --> Z{Continue?}
    Z -->|Ya| A
    Z -->|Tidak| AA([End Session])
    
    style INFO fill:#e8f5e9,stroke:#388e3c
    style TRANS fill:#fff3e0,stroke:#f57c00
                </pre>
            </div>
        </section>

        <!-- Diagram 6: Database Schema -->
        <section class="diagram-section">
            <div class="section-header" style="background: linear-gradient(135deg, #00796b 0%, #00695c 100%);">
                <h2>üóÑÔ∏è 6. Entity Relationship Diagram (ERD)</h2>
                <p>Skema Database PostgreSQL</p>
            </div>
            <div class="description-box" style="background: #e0f2f1; border-color: #00796b;">
                <h4 style="color: #00695c;">Tabel Utama:</h4>
                <ul>
                    <li><strong>document_chunks:</strong> Penyimpanan potongan dokumen knowledge base</li>
                    <li><strong>document_embeddings:</strong> Metadata embedding untuk vector search</li>
                    <li><strong>student_registrations:</strong> Data pendaftaran siswa baru</li>
                    <li><strong>registration_documents:</strong> Dokumen persyaratan pendaftaran</li>
                    <li><strong>conversations:</strong> Riwayat percakapan chatbot</li>
                </ul>
            </div>
            <div class="diagram-content">
                <pre class="mermaid">
erDiagram
    document_chunks ||--o{ document_embeddings : has
    student_registrations ||--o{ registration_documents : has
    student_registrations ||--o{ registration_tracking : has
    conversations }o--|| conversation_state : has

    document_chunks {
        int id PK
        varchar filename
        text content
        json metadata_json
        varchar status
        timestamp created_at
        timestamp updated_at
    }

    document_embeddings {
        int id PK
        int chunk_id FK
        json vector
        timestamp created_at
    }

    student_registrations {
        int id PK
        varchar registration_number UK
        json student_data
        json parent_data
        json academic_data
        varchar status
        timestamp created_at
    }

    registration_documents {
        int id PK
        int registration_id FK
        varchar document_type
        varchar filename
        text file_path
        varchar status
        timestamp uploaded_at
    }

    registration_tracking {
        int id PK
        int registration_id FK
        varchar status
        text notes
        timestamp created_at
    }

    conversations {
        int id PK
        varchar session_id
        text user_message
        text bot_response
        timestamp created_at
    }

    conversation_state {
        varchar session_id PK
        varchar current_step
        json collected_data
        timestamp created_at
        timestamp updated_at
    }
                </pre>
            </div>
        </section>

        <footer>
            <p>Dokumen Pendukung BAB III - Metodologi Penelitian</p>
            <p>Sistem Chatbot Berbasis LLM dengan RAG untuk YPI Al-Azhar Jakarta</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            er: {
                useMaxWidth: true
            }
        });
    </script>
</body>
</html>